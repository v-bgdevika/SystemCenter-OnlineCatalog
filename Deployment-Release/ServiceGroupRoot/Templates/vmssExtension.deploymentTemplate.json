{
  "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "parameters": {
      "vmssName": {
          "defaultValue": "new-vmss2",
          "type": "string"
      }
  },
  "variables": {},
  "resources": [
      {
          "type": "Microsoft.Compute/virtualMachineScaleSets",
          "name": "[parameters('vmssName')]",
          "apiVersion": "2018-06-01",
          "location": "[resourceGroup().location]",
          "...": "",
          "properties": {
              "...": "",
              "virtualMachineProfile": {
                  "...": "",
                  "extensionProfile": {
                      "extensions": [
                          {
                              "name": "DeployCodeExtension",
                              "properties": {
                                  "publisher": "Microsoft.Compute",
                                  "type": "CustomScriptExtension",
                                  "typeHandlerVersion": "1.10",
                                  "autoUpgradeMinorVersion": true,
                                  "settings": {
                                      "fileUris": [
                                          "https://onlinecatalogstorage1.blob.core.windows.net/scripts/deploycode.ps1"
                                      ],
                                      "timestamp": 202101021
                                  },
                                  "protectedSettings": {
                                      "commandToExecute": "powershell -ExecutionPolicy Unrestricted -File deploycode.ps1 -SomeParameter \"foobar\""
                                  }
                              }
                          }
                      ]
                  }
              }
          }
      }
  ]
}