{
  "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "parameters": {
    "VmssName": {
      "type": "string",
      "metadata": {
        "description": "String used as a base for naming resources."
      }
    }
  },
  "variables": {
    "Extension": "DeployCodeExtension"
  },
  "resources": [
    {
      "type": "Microsoft.Compute/virtualMachineScaleSets/extensions",
      "apiVersion": "2018-06-01",
      "name": "[concat(parameters('VmssName'), '/', variables('Extension'))]",
      "location": "[resourceGroup().location]",
      "properties": {
          "publisher": "Microsoft.Compute",
          "type": "CustomScriptExtension",
          "typeHandlerVersion": "1.10",
          "autoUpgradeMinorVersion": true,
          "settings": {
              "fileUris": [
                  "https://onlinecatalogstorage1.blob.core.windows.net/scripts/deploycode.ps1"
              ]
          },
          "protectedSettings": {
            "commandToExecute": "[concat('powershell.exe -ExecutionPolicy Unrestricted -File deploycode.ps1')]"
      }
    }
  }
  ]
}