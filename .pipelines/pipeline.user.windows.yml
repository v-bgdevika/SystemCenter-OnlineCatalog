environment:
  host:
    os: 'windows'
    flavor: 'server'
    version: '2019'
  runtime:
    provider: 'appcontainer'
    image: 'cdpxwin1809.azurecr.io/global/vse2019:latest'
    source_mode: 'map'

# signing_options:
#   profile: 'internal_azure_service'
  # codesign_validation_glob_pattern: 'regex|.-(?:js)$;-dir|**\node_modules\**'
    

restore:
  commands:
    - !!defaultcommand
      name: 'AzureDevOpsExtension Restore'
      command: 'src/WindowsServerSample/AzureDevOpsExtension/restore.cmd'
      fail_on_stderr: false

build:
  commands:
    - !!buildcommand
      name: 'Build AzureDevOpsExtension'
      fail_on_stderr: false
      command: 'src/WindowsServerSample/AzureDevOpsExtension/build.cmd'
      artifacts:
        - from: 'src/WindowsServerSample/azure-devops-extension-sample'
          to: 'Windows/AzureDevOpsExtension'
          include:
            - '**/*'

static_analysis_options:
  policheck_options:
    scan_comments: true
    files_to_scan:
      - exclude:
        - 'src\**\node_modules\**.js'
        - 'src\**\node_modules\**.txt'
        - 'src\**\node_modules\**.md'
  binskim_options:
    files_to_scan:
      - from: 'src'
        exclude:
        - '**/node_modules/**/*.exe'
        - '**/node_modules/**/*.js'
  moderncop_options:
    files_to_scan:
      - from: 'src'
        exclude:
        - '**/Node/**/*.js'  # Ignore all because ModernCop does not support ES6+ JavaScript, which is what this application is written with. We are supposed to use TSLint instead. https://www.1eswiki.com/wiki/Secure_Development_Tools_Extension_For_Azure_DevOps
        - '**/node_modules/**/*.exe'
        - '**/node_modules/**/*.js'
